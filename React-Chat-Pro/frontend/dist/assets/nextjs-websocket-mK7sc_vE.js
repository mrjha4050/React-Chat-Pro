import{R as p}from"./react-0DFgWoTb.js";function l(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,c(t,n)}function c(t,n){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,e){return o.__proto__=e,o},c(t,n)}function a(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}require("websocket").w3cwebsocket;var u=require("websocket").w3cwebsocket,h=function(t){l(n,t);function n(o){var e;return e=t.call(this,o)||this,e.state={ws:new u(e.props.url),attempts:1},e.sendMessage=e.sendMessage.bind(a(e)),e.setupWebsocket=e.setupWebsocket.bind(a(e)),e}var s=n.prototype;return s.logging=function(e){this.props.debug===!0&&console.log(e)},s.generateInterval=function(e){return this.props.reconnectIntervalInMilliSeconds>0?this.props.reconnectIntervalInMilliSeconds:Math.min(30,Math.pow(2,e)-1)*1e3},s.setupWebsocket=function(){var e=this,r=this.state.ws;r.onopen=function(){e.logging("Websocket connected..."),typeof e.props.onOpen=="function"&&e.props.onOpen()},r.onerror=function(i){typeof e.props.onError=="function"&&e.props.onError(i)},r.onmessage=function(i){e.props.onMessage(i.data)},this.shouldReconnect=this.props.reconnect,r.onclose=function(i){if(e.logging("Websocket disconnected,the reason: "+i.reason+",the code: "+i.code),typeof e.props.onClose=="function"&&e.props.onClose(i.code,i.reason),e.shouldReconnect){var f=e.generateInterval(e.state.attempts);e.timeoutID=setTimeout(function(){e.setState({attempts:e.state.attempts+1}),e.setState({ws:new u(e.props.url)}),e.setupWebsocket()},f)}}},s.componentDidMount=function(){var e=this.props.childRef;e&&e(this),this.setupWebsocket()},s.componentWillUnmount=function(){var e=this.props.childRef;e&&e(void 0),this.shouldReconnect=!1,clearTimeout(this.timeoutID);var r=this.state.ws;r.close()},s.sendMessage=function(e){var r=this.state.ws;r.send(e)},s.render=function(){return p.createElement("div",null)},n}(p.Component);export{h as W};
